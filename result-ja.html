<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Language" content="ja">
    <link rel="shortcut icon" type="image/png" href="/abc.jpg"/>
    <title>紫微斗数命盤 - 結果</title>
    <link rel="stylesheet" type="text/css" href="js/ziwei.css">
    <style>
        body {
            background-color: #FFFFFF !important;
            padding: 10px 25px;
            margin: 0;
            min-height: 100vh;
        }

        .header-controls {
            margin: 20px 0;
            text-align: center;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .language-switcher {
            display: flex;
            gap: 10px;
        }

        .lang-btn {
            padding: 5px 12px;
            background-color: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            text-decoration: none;
            color: #666;
            font-size: 13px;
            transition: all 0.3s;
        }

        .lang-btn:hover {
            background-color: #e0e0e0;
        }

        .lang-btn.active {
            background-color: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }

        .btn-back {
            padding: 10px 20px;
            background-color: #008CBA;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }

        .btn-back:hover {
            background-color: #007399;
        }

        .zwDivHeader h2 {
            text-align: center;
        }

        .no-data-message {
            text-align: center;
            padding: 50px;
            font-size: 18px;
            color: #666;
        }

        /* 命盤自適應高度 - MacBook Air M2 最適化 */
        .ziwei {
            height: 68vh !important;
            min-height: 480px;
            max-height: 650px;
        }

        .ziwei > div {
            min-height: 120px;
        }

        @media only screen and (max-width: 1024px) {
            .ziwei {
                height: auto !important;
                min-height: 420px;
            }
            .ziwei > div {
                min-height: 110px;
            }

            .header-controls {
                flex-direction: column;
                gap: 10px;
            }
        }

        /* モバイル横向き最適化 */
        @media only screen and (max-width: 768px) {
            .ziwei {
                min-height: 280px;
                max-height: 450px;
            }
            .ziwei > div {
                min-height: 60px;  /* 100%ズームに対応するため50%縮小 */
            }
        }

        /* モバイル縦向き最適化 */
        @media only screen and (max-width: 480px) {
            .ziwei {
                min-height: 240px;
                max-height: 380px;
            }
            .ziwei > div {
                min-height: 50px;  /* 100%ズームに対応するため50%縮小 */
            }
            .header-controls {
                margin: 10px 0;
            }
            .btn-back {
                font-size: 14px;
                padding: 8px 15px;
            }
            .lang-btn {
                font-size: 11px;
                padding: 4px 8px;
            }
        }
    </style>
</head>
<body>
    <div class="header-controls">
        <input type="button" value="← 入力に戻る" class="btn-back" id="btnBack">

        <div class="language-switcher">
            <a href="result.html" class="lang-btn">中文</a>
            <a href="result-en.html" class="lang-btn">English</a>
            <a href="result-ja.html" class="lang-btn active">日本語</a>
        </div>
    </div>

    <div id="container"></div>

    <!-- Buy Me a Coffee ボタン -->
    <div style="position: fixed; bottom: 20px; right: 20px; z-index: 1000;">
        <a href="https://www.buymeacoffee.com/jinhssu" target="_blank">
            <img src="https://cdn.buymeacoffee.com/buttons/v2/default-green.png"
                 alt="Buy Me A Coffee"
                 style="height: 60px !important; width: 217px !important;">
        </a>
    </div>

    <script src="lunar.js"></script>
    <script src="ziweistar.js"></script>
    <script src="ziweicore.js"></script>
    <script src="ziweiui.js"></script>
    <script src="js/language.js"></script>
    <script>
        // localStorage からデータを読み込んで計算
        window.addEventListener('load', function() {
            const zwDataStr = localStorage.getItem('zwData');

            if (!zwDataStr) {
                document.getElementById("container").innerHTML =
                    "<div class='no-data-message'>" +
                    "<h2>データが見つかりません</h2>" +
                    "<p>入力ページに戻って生年月日を入力してください</p>" +
                    "</div>";
                return;
            }

            const zwData = JSON.parse(zwDataStr);

            // 紫微斗数UI を初期化（入力フォームなし）
            initResultUI();

            // 保存されたデータで計算
            calculateWithData(zwData.year, zwData.month, zwData.day, zwData.hour, zwData.gender);

            // 戻るボタン
            document.getElementById("btnBack").addEventListener('click', function() {
                window.location.href = 'index-ja.html';
            });
        });

        function initResultUI() {
            // 結果表示の HTML 構造を作成（入力フォームなし）
            document.getElementById("container").innerHTML =
                "<div class='zwDivHeader'><h2>紫微斗数命盤の結果</h2></div>" +
                "<div class='ziwei'>" +
                "<div id='zw6'></div>" +
                "<div id='zw7'></div>" +
                "<div id='zw8'></div>" +
                "<div id='zw9'></div>" +
                "<div id='zw5'></div>" +
                "<div id='zwHome' class='zwDivCenter'></div>" +
                "<div id='zw10'></div>" +
                "<div id='zw4'></div>" +
                "<div id='zw11'></div>" +
                "<div id='zw3'></div>" +
                "<div id='zw2'></div>" +
                "<div id='zw1'></div>" +
                "<div id='zw12'></div>" +
                "</div>";
        }

        function calculateWithData(year, month, day, hour, gender) {
            // 元の紫微斗数計算ロジックを使用
            const zw = ziwei.computeZiWei(year, month, day, hour, gender);

            // 基本情報を表示
            document.getElementById("zwHome").innerHTML =
                "西暦: " + ziwei.getSolarDay() + "<br>" +
                "旧暦: " + ziwei.getLunarDay() + "<br>" +
                "干支: 【" + ziwei.getShengXiao() + "】" + "<br>" +
                "<div>" + ziwei.getFiveElement() + "</div>" +
                "<div>" + ziwei.getYinYangGender() + "</div>";
                // "<div class='zwcopy'>by cubshuang</div>";  // 署名を非表示

            // 描画方向設定
            const right2left = false; // デフォルトは左から右
            const styleLR = [" zwStarLeft", " zwStarRight"];
            if (right2left) {
                styleLR.reverse();
            }

            // 星を描画
            for (let i = 0; i < 12; i++) {
                document.getElementById("zw" + (i + 1).toString()).innerHTML =
                    "<div class='MangA'>" + EarthlyBranches[i] + "</div>" +
                    "<div class='MangA'>" + zw[i].MangA + "</div>" +
                    "<div class='MangB'>" + zw[i].MangB + "</div>" +
                    "<div class='MangC'>" + zw[i].MangC + "</div>" +
                    "<div class='StarAll'>" + zw[i].StarAll + "</div>";

                let StarA1 = "", StarA2 = "", StarA3 = "", StarB1 = "", StarB2 = "", StarC1 = "", StarC2 = "";
                const tmpSatrA = [[], [], []];
                let k = 0;

                for (let j = 0; j < zw[i].StarA.length; j++) {
                    tmpSatrA[0][k] = zw[i].StarA[j].substring(0, 1);
                    tmpSatrA[1][k] = zw[i].StarA[j].substring(1, 2);
                    tmpSatrA[2][k] = (zw[i].StarA[j].length > 2) ? "<span>" + zw[i].StarA[j].substring(3, 4) + "</span>" : "　";
                    k += 1;
                }

                for (let j = 0; j < zw[i].Star6.length; j++) {
                    tmpSatrA[0][k] = "<span>" + zw[i].Star6[j].substring(0, 1) + "</span>";
                    tmpSatrA[1][k] = "<span>" + zw[i].Star6[j].substring(1, 2) + "</span>";
                    tmpSatrA[2][k] = (zw[i].Star6[j].length > 2) ? "<span>" + zw[i].Star6[j].substring(3, 4) + "</span>" : "　";
                    k += 1;
                }

                if (right2left) {
                    for (let j = 0; j < 3; j++) {
                        tmpSatrA[j].reverse();
                    }
                }

                for (let j = 0; j < tmpSatrA[0].length; j++) {
                    StarA1 += tmpSatrA[0][j];
                    StarA2 += tmpSatrA[1][j];
                    StarA3 += tmpSatrA[2][j];
                }

                for (let j = 0; j < zw[i].StarB.length; j++) {
                    StarB1 += zw[i].StarB[j].substring(0, 1);
                    StarB2 += zw[i].StarB[j].substring(1, 2);
                }

                for (let j = 0; j < zw[i].StarC.length; j++) {
                    StarC1 += zw[i].StarC[j].substring(0, 1);
                    StarC2 += zw[i].StarC[j].substring(1, 2);
                }

                document.getElementById("zw" + (i + 1).toString()).innerHTML +=
                    "<div class='StarA" + styleLR[0] + "'>" + StarA1 + "<br>" + StarA2 + "<br><div class='Star4'>" + StarA3 + "</div></div>" +
                    "<div class='StarB" + styleLR[1] + "'>" + StarB1 + "<br>" + StarB2 + "</div>" +
                    "<div class='StarC'>" + StarC1 + "<br>" + StarC2 + "</div>";
            }

            // 大小限表
            const DS_Shian = ziwei.getDaShian();
            for (let i = 0; i < 12; i++) {
                document.getElementById("zw" + (i + 1).toString()).innerHTML +=
                    "<div class='MangY10'>" + DS_Shian.DShian[i + 1] + "</div>" +
                    "<div class='MangY1'>" + DS_Shian.SShian[i + 1] + "</div>";
            }
        }
    </script>
</body>
</html>
