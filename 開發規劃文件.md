# 紫微斗數網站多語言與功能擴充開發規劃

**版本**: 2.0
**日期**: 2025-10-29
**負責人**: Claude Code

---

## 📋 專案概述

本次開發將為紫微斗數計算網站新增以下功能：
1. 多語言支援（繁體中文、英文、日文）
2. 地點輸入功能
3. 24小時制時間輸入並轉換為時辰
4. Buy Me a Coffee 捐款整合

---

## 🌍 一、多語言系統設計

### 1.1 架構決策

**選擇方案**：分離 HTML 檔案（而非單頁 i18n）

**理由**：
- ✅ SEO 優化：每個語言有獨立 URL
- ✅ 效能佳：無需載入語言切換套件
- ✅ 維護簡單：適合小型專案
- ✅ 彈性高：可針對各語言市場客製化

### 1.2 檔案結構

```
/
├── index.html          # 中文輸入頁（預設）
├── index-en.html       # 英文輸入頁
├── index-ja.html       # 日文輸入頁
├── result.html         # 中文結果頁
├── result-en.html      # 英文結果頁
├── result-ja.html      # 日文結果頁
└── js/
    └── language.js     # 語言切換共用邏輯
```

### 1.3 語言切換設計

**位置**：頁面右上角
**樣式**：水平排列的語言按鈕

```html
<div class="language-switcher">
    <a href="index.html" class="lang-btn active">中文</a>
    <a href="index-en.html" class="lang-btn">English</a>
    <a href="index-ja.html" class="lang-btn">日本語</a>
</div>
```

**行為**：
- 點擊後切換到對應語言版本
- 當前語言高亮顯示
- 使用 localStorage 記住使用者語言偏好

### 1.4 翻譯內容規劃

| 元素 | 中文 | English | 日本語 |
|------|------|---------|--------|
| 標題 | 紫微斗數命盤 | Zi Wei Dou Shu | 紫微斗数命盤 |
| 計算按鈕 | 開始計算 | Calculate | 計算開始 |
| 返回按鈕 | 返回輸入頁面 | Back to Input | 入力に戻る |
| 性別 | 男/女 | Male/Female | 男性/女性 |
| 載入提示 | 計算中請稍候... | Calculating... | 計算中... |

*完整翻譯對照表請參考「翻譯對照表.md」*

---

## 📍 二、地點輸入功能

### 2.1 需求說明

**目的**：記錄使用者出生地點，用於：
- 時區校正（未來擴充）
- 資料分析
- Google Sheets 記錄

### 2.2 輸入方式

**方案 A**：自由文字輸入（建議）
```html
<input type="text" id="location" placeholder="例如：台北市">
```

**優點**：
- ✅ 簡單直覺
- ✅ 不限制輸入格式
- ✅ 適合國際使用者

**方案 B**：下拉選單
- ❌ 選項有限
- ❌ 維護成本高

**最終選擇**：方案 A

### 2.3 資料處理

```javascript
const data = {
    year: year,
    month: month,
    day: day,
    hour: hour,
    location: location,  // 新增
    gender: gender,
    timestamp: new Date().toISOString()
};
```

### 2.4 Google Sheets 欄位

新增欄位：
| 欄位名稱 | 資料類型 | 範例 |
|---------|---------|------|
| 地點 | 文字 | 台北市 / Tokyo / New York |

---

## ⏰ 三、24小時制時間輸入

### 3.1 需求說明

**變更前**：下拉選單選擇時辰（子、丑、寅...）
**變更後**：輸入具體時間（00:00-23:59）→ 自動轉換時辰

### 3.2 UI 設計

**方案 A**：HTML5 time input（建議）
```html
<input type="time" id="birthTime" value="12:00">
```

**優點**：
- ✅ 原生瀏覽器支援
- ✅ 自動格式驗證
- ✅ 行動裝置友善

**方案 B**：兩個下拉選單（小時 + 分鐘）
- 🟡 需要更多程式碼
- 🟡 使用體驗較差

**最終選擇**：方案 A

### 3.3 時辰轉換邏輯

```javascript
// 時間轉時辰對照表
const timeToEarthlyBranch = (hour, minute) => {
    // 23:00-00:59 → 子時
    // 01:00-02:59 → 丑時
    // 03:00-04:59 → 寅時
    // ...依此類推

    const earthlyBranches = ["子", "丑", "寅", "卯", "辰", "巳",
                              "午", "未", "申", "酉", "戌", "亥"];

    // 處理 23:00 之後算隔日子時
    if (hour >= 23) return earthlyBranches[0];

    const index = Math.floor((hour + 1) / 2) % 12;
    return earthlyBranches[index];
};
```

### 3.4 使用者體驗

1. **顯示對應時辰**：
   ```
   [12:30] → 午時 (11:00-13:00)
   ```

2. **即時預覽**：使用者輸入時間時，即時顯示對應時辰

3. **保留快速選項**：
   ```html
   <button>現在時間</button>
   <button>子時 (23-01)</button>
   <button>午時 (11-13)</button>
   ```

---

## ☕ 四、Buy Me a Coffee 整合

### 4.1 整合方式

**Buy Me a Coffee** 提供多種嵌入方式：

#### 選項 1：浮動按鈕（建議）
- 固定在頁面右下角
- 不干擾內容閱讀
- 隨頁面滾動

#### 選項 2：內嵌按鈕
- 放在頁面底部
- 與其他內容一起呈現

#### 選項 3：文字連結
- 最簡潔
- 整合在隱私聲明區塊

**建議**：選項 1（浮動按鈕）

### 4.2 實作步驟

1. **取得您的 Buy Me a Coffee 連結**
   - 格式：`https://www.buymeacoffee.com/您的用戶名`

2. **建立浮動按鈕 HTML**
   ```html
   <a href="https://www.buymeacoffee.com/您的用戶名"
      target="_blank"
      class="bmc-button">
       <img src="bmc-icon.svg" alt="Buy me a coffee">
       <span>支持我們</span>
   </a>
   ```

3. **CSS 樣式**
   ```css
   .bmc-button {
       position: fixed;
       bottom: 20px;
       right: 20px;
       z-index: 1000;
   }
   ```

### 4.3 多語言文案

| 語言 | 按鈕文字 |
|------|---------|
| 中文 | ☕ 請我喝杯咖啡 |
| English | ☕ Buy me a coffee |
| 日本語 | ☕ コーヒーをおごる |

### 4.4 Buy Me a Coffee 官方整合

**使用官方嵌入程式碼**：

1. 前往：https://www.buymeacoffee.com/dashboard/widgets
2. 選擇「Button」或「Floating Widget」
3. 複製程式碼
4. 貼到網頁中

**範例**：
```html
<script data-name="BMC-Widget"
        data-cfasync="false"
        src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js"
        data-id="您的用戶名"
        data-description="Support me!"
        data-message="感謝您的支持！"
        data-color="#FF813F"
        data-position="Right"
        data-x_margin="18"
        data-y_margin="18">
</script>
```

---

## 🔄 五、資料流程更新

### 5.1 更新後的資料結構

```javascript
{
    timestamp: "2025-10-29T12:00:00.000Z",
    year: "1990",
    month: "3",
    day: "15",
    birthTime: "12:30",        // 新增：24小時制時間
    hour: "午",                 // 轉換後的時辰
    location: "台北市",         // 新增：地點
    gender: "M",
    language: "zh-TW"          // 新增：使用的語言版本
}
```

### 5.2 Google Sheets 欄位更新

| 欄位 | 說明 |
|------|------|
| 時間戳記 | 資料輸入時間 |
| 西元年 | 出生年份 |
| 月 | 出生月份 |
| 日 | 出生日期 |
| 出生時間 | 24小時制（新增） |
| 時辰 | 轉換後的地支 |
| 地點 | 出生地點（新增） |
| 性別 | 男/女 |
| 語言 | 使用的介面語言（新增） |

### 5.3 Google Apps Script 更新

```javascript
sheet.appendRow([
    data.timestamp,
    data.year,
    data.month,
    data.day,
    data.birthTime,    // 新增
    data.hour,
    data.location,     // 新增
    data.gender,
    data.language      // 新增
]);
```

---

## 📊 六、開發優先順序

### Phase 1：多語言基礎（高優先）
1. 建立 6 個 HTML 檔案
2. 實作語言切換器
3. 完成基本翻譯

**預估時間**：2-3 小時

### Phase 2：功能擴充（中優先）
1. 新增地點輸入
2. 改為 24 小時制
3. 實作時辰轉換邏輯

**預估時間**：1-2 小時

### Phase 3：整合與優化（中優先）
1. 整合 Buy Me a Coffee
2. 更新 Google Sheets 結構
3. 測試所有功能

**預估時間**：1 小時

### Phase 4：部署與文件（低優先）
1. 更新部署文件
2. 更新 README
3. 部署到 GitHub Pages

**預估時間**：0.5 小時

**總預估時間**：4.5-6.5 小時

---

## 🧪 七、測試計畫

### 7.1 功能測試

| 功能 | 測試項目 | 預期結果 |
|------|---------|---------|
| 語言切換 | 點擊各語言按鈕 | 正確切換頁面 |
| 地點輸入 | 輸入各種格式 | 正確儲存 |
| 時間轉換 | 輸入不同時間 | 正確轉換時辰 |
| Buy Me a Coffee | 點擊按鈕 | 開啟新視窗 |
| Google Sheets | 提交資料 | 正確儲存所有欄位 |

### 7.2 跨瀏覽器測試

- Chrome
- Firefox
- Safari
- Edge

### 7.3 響應式測試

- 桌面（1920x1080）
- 平板（768x1024）
- 手機（375x667）

---

## 🚀 八、部署策略

### 8.1 版本管理

```bash
# 建立新分支
git checkout -b feature/multilingual

# 開發完成後
git add .
git commit -m "feat: 新增多語言支援與功能擴充"
git push origin feature/multilingual

# 合併到主分支
git checkout main
git merge feature/multilingual
git push
```

### 8.2 部署檢查清單

- [ ] 所有翻譯已完成
- [ ] 功能測試通過
- [ ] 跨瀏覽器測試通過
- [ ] Google Sheets 整合測試通過
- [ ] Buy Me a Coffee 連結正確
- [ ] 更新 README.md
- [ ] 更新部署教學.md

---

## 📝 九、風險評估

| 風險 | 影響 | 機率 | 應對策略 |
|------|------|------|---------|
| 翻譯不準確 | 中 | 中 | 請母語使用者檢查 |
| 時辰轉換錯誤 | 高 | 低 | 完整單元測試 |
| 多檔案維護困難 | 中 | 中 | 建立更新腳本 |
| Buy Me a Coffee 被廣告攔截 | 低 | 中 | 提供替代捐款方式 |

---

## 📚 十、相關文件

- [開發 Tickets](./開發Tickets.md)
- [翻譯對照表](./翻譯對照表.md)
- [API 文件](./API文件.md)
- [測試報告](./測試報告.md)

---

## ✅ 十一、驗收標準

### 11.1 功能完整性

- [ ] 三種語言版本都能正常運作
- [ ] 語言切換功能正常
- [ ] 地點輸入與儲存正常
- [ ] 24 小時制轉時辰正確
- [ ] Buy Me a Coffee 按鈕正常顯示

### 11.2 使用者體驗

- [ ] 介面美觀一致
- [ ] 載入速度快（< 2 秒）
- [ ] 行動裝置體驗佳
- [ ] 錯誤訊息清晰

### 11.3 程式碼品質

- [ ] 程式碼結構清晰
- [ ] 註解完整
- [ ] 無 console 錯誤
- [ ] 通過程式碼審查

---

## 📧 聯絡資訊

**專案負責人**：chinghssu@gmail.com
**問題回報**：GitHub Issues
**技術文件**：本專案 `/docs` 目錄

---

---

## 🆕 十二、時間輸入模式擴充（v3.0）

### 12.1 需求背景

**問題描述**：
1. 當手動輸入 23:00-23:59 的時間時，雖然顯示「子時」，但日期沒有自動調整為隔日
2. 使用者可能習慣使用地支時辰而非標準時間輸入

**解決方案**：
1. 新增雙模式時間輸入（標準時間 / 地支時辰）
2. 實作 23:00-23:59 自動日期調整功能

### 12.2 功能設計

#### 12.2.1 時間輸入模式切換

新增 radio 選項讓使用者選擇輸入方式：

```html
<div class="form-group">
    <label>時間輸入方式</label>
    <div class="radio-group">
        <label>
            <input type="radio" name="timeMode" value="standard" checked> 標準時間
        </label>
        <label>
            <input type="radio" name="timeMode" value="branch"> 地支時辰
        </label>
    </div>
</div>
```

**標準時間模式**：
- 使用 `<input type="time">` 選擇器
- 即時顯示對應的地支時辰
- 23:00-23:59 顯示「【隔日子時】」提示

**地支時辰模式**：
- 使用 `<select>` 下拉選單
- 顯示所有十二時辰及其時間範圍
- 例如：「子時 (23:00-00:59)」

#### 12.2.2 日期自動調整邏輯

新增函數處理 23:00-23:59 的日期調整：

```javascript
/**
 * 根據時間調整日期（處理 23:00-23:59 子時的日期問題）
 */
function adjustDateForTime(year, month, day, time) {
    if (needsDateAdjustment(time)) {
        const date = new Date(year, month - 1, day);
        date.setDate(date.getDate() + 1);
        return {
            year: date.getFullYear(),
            month: date.getMonth() + 1,
            day: date.getDate()
        };
    }
    return { year, month, day };
}
```

**調整規則**：
- 如果輸入時間為 23:00-23:59，日期自動 +1 天
- 如果選擇「子時」（地支模式），日期自動 +1 天
- 跨月、跨年的情況由 JavaScript Date 物件自動處理

### 12.3 檔案修改清單

#### 12.3.1 `js/time-converter.js`

新增以下函數：

1. `getAllEarthlyBranches()` - 取得所有時辰選項（用於下拉選單）
2. `needsDateAdjustment(time)` - 檢查是否需要調整日期
3. `adjustDateForTime(year, month, day, time)` - 根據時間調整日期

#### 12.3.2 `index.html`

1. 新增時間輸入模式切換 UI
2. 新增地支時辰下拉選單
3. 更新時辰顯示邏輯（顯示「【隔日子時】」提示）
4. 更新計算按鈕邏輯（處理雙模式和日期調整）
5. 更新提示文字

### 12.4 使用者介面更新

**更新前**：
```
[出生時間]
[12:00] → 午時 (11:00-12:59)
```

**更新後（標準時間模式）**：
```
[時間輸入方式]
○ 標準時間  ○ 地支時辰

[出生時間]
[23:30] → 子時 (23:00-00:59) 【隔日子時】
```

**更新後（地支時辰模式）**：
```
[時間輸入方式]
○ 標準時間  ● 地支時辰

[出生時間]
[下拉選單: 子時 (23:00-00:59)]
```

### 12.5 資料結構更新

新增 `timeMode` 欄位到 localStorage：

```javascript
{
    year: "1990",
    month: "10",
    day: "16",              // 自動調整後的日期（原為 10/15）
    birthTime: "23:58",
    hour: "子",
    gender: "M",
    language: "zh",
    timeMode: "standard",   // 新增：記錄使用的輸入模式
    timestamp: "2025-11-13T..."
}
```

### 12.6 測試案例

| 測試項目 | 輸入 | 預期結果 |
|---------|------|---------|
| 標準時間 - 午時 | 10/15 12:00 | 10/15 午時 |
| 標準時間 - 子時 | 10/15 23:58 | 10/16 子時【提示隔日】 |
| 標準時間 - 早子時 | 10/15 00:30 | 10/15 子時 |
| 地支時辰 - 午時 | 10/15 午時 | 10/15 午時 |
| 地支時辰 - 子時 | 10/15 子時 | 10/16 子時 |
| 跨月邊界 | 10/31 23:30 | 11/01 子時 |
| 跨年邊界 | 12/31 23:30 | (次年)01/01 子時 |

### 12.7 向後相容性

- 現有的 `birthTime` 和 `hour` 欄位保持不變
- Google Sheets 不需要修改
- 舊資料仍可正常讀取（`timeMode` 為 undefined 時視為標準模式）

### 12.8 待辦事項

- [ ] 更新英文版本 (index-en.html)
- [ ] 更新日文版本 (index-ja.html)
- [ ] 更新翻譯對照表
- [ ] 進行完整測試（包含跨月、跨年案例）

---

**文件版本歷史**

| 版本 | 日期 | 變更內容 |
|------|------|---------|
| 1.0 | 2025-10-29 | 初始版本 |
| 2.0 | 2025-10-29 | 新增多語言與功能擴充規劃 |
| 3.0 | 2025-11-13 | 新增時間輸入模式擴充與日期自動調整功能 |
